<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>吹雨听风</title>
  
  <subtitle>热爱写代码.</subtitle>
  <link href="https://www.wewx.cn/atom.xml" rel="self"/>
  
  <link href="https://www.wewx.cn/"/>
  <updated>2022-04-21T05:07:21.011Z</updated>
  <id>https://www.wewx.cn/</id>
  
  <author>
    <name>吹雨听风</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>给博客上了一款新主题 《snow white》</title>
    <link href="https://www.wewx.cn/2022/04/16/hexo-theme-snow-white/"/>
    <id>https://www.wewx.cn/2022/04/16/hexo-theme-snow-white/</id>
    <published>2022-04-16T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<p>使用 hexo 创建博客也有好几个年头了，可已写下的文章的不多，就一直是默认的主题挂在那儿。</p><p>今年以来立志要练习写作，也就打算好好的整一下这个静态博客，第一件事自然是得整个好看的、符合我极简审美的主题。耐何在 Hexo 主题站上找了一圈，也没有找到完全合意的主题，那就自己写一个。说干就开，于是之款起名叫《snow white》的主题诞生。</p><p>这是我开发的第一款主题，虽有些不足，但也有些特点。</p><h3 id="极致的简约"><a href="#极致的简约" class="headerlink" title="极致的简约"></a>极致的简约</h3><p>整体以白色设计为主，没有边边框框、背景色之类的装饰，自然更不会有 icon 和各种图标了。</p><h3 id="使用-Tailwind-css"><a href="#使用-Tailwind-css" class="headerlink" title="使用 Tailwind css"></a>使用 Tailwind css</h3><p>主题的风格样式完全使用 <a href="https://tailwindcss.com/">Tailwind css</a> 进行定义，编译后也仅仅只有 13kb。Tailwind css　是一个功能类优先的 CSS 框架，样式能够语义化，这样整体的布局、样式都更加清晰明了，方便进行二次开发和调整。</p><h3 id="中文排版"><a href="#中文排版" class="headerlink" title="中文排版"></a>中文排版</h3><p>中文排版一直是个比较头痛的问题了，为使文章易于阅读，在本主题中直接使用 <a href="https://typo.sofi.sh/">typo css</a> 进行文章正文的排版。　</p><h3 id="文章优化"><a href="#文章优化" class="headerlink" title="文章优化"></a>文章优化</h3><p>扩展了文章元数据，增加了</p><ul><li>相关文章</li><li>外部链接，可以申明本文的转载来源</li></ul><h3 id="seo-优化"><a href="#seo-优化" class="headerlink" title="seo 优化"></a>seo 优化</h3><p>扩展了页面和文章的 seo 元数据，支持为每篇文章或每个页面设置 seo 信息</p><ul><li>seo 描述　</li><li>seo 关键词　</li><li>seo title</li></ul><h3 id="深色模式"><a href="#深色模式" class="headerlink" title="深色模式"></a>深色模式</h3><p>暂未之前，后续再说。</p><h2 id="主题下载"><a href="#主题下载" class="headerlink" title="主题下载"></a>主题下载</h2><p>从 github 下载<a href="https://github.com/cmzz/hexo-theme-snow-white">《snow white》</a>主题</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>在制作主题的过程中，参考了以下几款优秀主题：</p><ul><li><a href="https://d2fan.com/">https://d2fan.com/</a></li><li><a href="http://niexiaotao.cn/">http://niexiaotao.cn/</a></li><li><a href="https://typo.sofi.sh/">https://typo.sofi.sh/</a></li></ul>]]></content>
    
    
    <summary type="html">snow white 是 hexo 的一款极致简约的博客主题，纯白色调设计，无任何多余元素和图标，seo 支持友好，如果喜欢简约风格可以尝试</summary>
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>docker 端口的 expose 与 publish</title>
    <link href="https://www.wewx.cn/2018/08/24/docker-expose-publish/"/>
    <id>https://www.wewx.cn/2018/08/24/docker-expose-publish/</id>
    <published>2018-08-24T02:36:48.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<p>在 <code>Dockerfile</code> 里通过 <code>Expose</code> 导出一个 <code>80</code> 的端口:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure><p>启动容器后,发现还是无法本机的 <code>80</code> 端口访问容器内服务。只有在启动时通过 <code>-p</code> 参数publish 端口才可以，像下面这样:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:80 demo</span><br></pre></td></tr></table></figure><p>这是为啥呢?<br>都已经在 <code>Dockerfile</code> 里面 <code>Expose</code> 为啥还不能直接访问?</p><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p>使用下面4中不同的方法启动容器:</p><ul><li>不在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，也不通过 <code>-p</code> 参数指定</li><li>在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，但不使用 <code>-p</code> 参数</li><li>在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，也使用 <code>-p</code> 参数</li><li>只使用 <code>-p</code> 参数</li></ul><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><ul><li>第一中情况: 不能在外网访问，也不能被 link 的 container 访问</li><li>第二种情况: 不能被外网访问，但是能被 link 的 container 访问</li><li>第三种情况: 能被外网访问，也能被 link 容器访问</li><li>第四中情况: 和第三种情况一样</li></ul><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p><code>EXPOSE</code> 只是导出端口。只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务。<br>在 <code>Dockerfile</code> 中写入这样的声明有两个好处，一个是帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射；另一个用处则是在运行时使用随机端口映射时，也就是 <code>docker run -P</code> 时，会自动随机映射 <code>EXPOSE</code> 的端口。</p><p>通过 <code>docker ps</code> 命令，可以看到，端口的映射关系。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在 &lt;code&gt;Dockerfile&lt;/code&gt; 里通过 &lt;code&gt;Expose&lt;/code&gt; 导出一个 &lt;code&gt;80&lt;/code&gt; 的端口:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutt</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://www.wewx.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>docker 网络之端口映射不完全探索</title>
    <link href="https://www.wewx.cn/2018/07/20/docker-network-port-mapping/"/>
    <id>https://www.wewx.cn/2018/07/20/docker-network-port-mapping/</id>
    <published>2018-07-20T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<p>这篇文章实在团队内部的分享，如下：</p><p>今天的分享不包含故事背景、docker的发展与应用…</p><p>分享源于对问题 ‘我已经在　Dockerfile 中通过 EXPOSE 指定了端口为何任然无法访问？’ 深入探索。其实今天的分享也可以视为对上一期峰哥分享的一个补充。</p><p>Docker容器的端口映射</p><blockquote><p>容器的服务端口绑定到宿主机的端口上。效果就是：外部程序通过宿主机的P端口访问，就像直接访问 Docker 容器网络内部容器提供的服务一样。</p></blockquote><p>今天的分享主要涉及到的 Docker run 命令，参数如下：</p><ul><li>-p&#x2F;-P</li><li>–expose</li></ul><h3 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h3><p>expose 参数有两种使用形式：</p><ul><li>在 <code>docker run</code> 命令时指定 <code>--expose</code> 参数, 如 –expose&#x3D;8080</li><li>在 Dockerfile 中，通过 <code>EXPOSE</code> 关键字</li></ul><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><blockquote><p><code>EXPOSE</code> 指令是声明运行时容器提供服务端口。</p></blockquote><p><strong>注意</strong>：</p><p>仅仅是申明。并不是说你声明了这个端口，在运行容器的时候就会自动的暴露这个端口。使用时，还要依赖于容器的操作人员进一步指定网络规则。</p><p>本质上来说， <code>EXPOSE</code> 或者 <code>--expose</code> 只是为其他命令提供所需信息的元数据，或者只是告诉容器操作人员有哪些已知选择。</p><p>验证：　通过　<code>docker run nginx</code> 启动一个容器, 然后通过　｀docker inspect id&#96;　查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;PortBindings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;443/tcp&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;80/tcp&quot;</span>: null</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到端口被标示成已暴露，但是没有定义任何与主机的端口映射。</p><h4 id="p-x2F-P"><a href="#p-x2F-P" class="headerlink" title="-p&#x2F;-P"></a>-p&#x2F;-P</h4><p><code>-p</code> 与 <code>-P</code>　参数的完整形式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-p, --publish list </span><br><span class="line">-P, --publish-all </span><br></pre></td></tr></table></figure><p>这两个参数都是发布端口到宿主主机。但用法上存在一点区别。</p><p><code>-p</code> 显式将一个或者一组端口从容器里绑定到宿主机上。<br><code>-P</code> 自动的将EXPOSE指令相关的每个端口映射到宿主机的端口上。</p><p>-p 参数常见的用法是: <code>-p 宿主主机端口:容器端口</code>。　如果使用　｀docker run -p 8080:80 nginx&#96; 命令启动nginx 容器，那么容器中的 80端口会绑定到主机的8080端口。</p><p>这是，我们再通过　<code>docker inspect id</code> 来查看，将会看到下面的绑定关系:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;PortBindings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;443/tcp&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;80/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;HostPort&quot;</span>: <span class="string">&quot;8080&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>因为没有指定443端口的绑定，所以能看到仅有 80端口和宿主机存在端口映射关系。</p><p>另外，在使用-p参数是，我们可以忽略指定宿主主机端口。这是，docker会帮助我们自动的选择一个合适端口和容器端口进行绑定。这样做的好处是在启动多个容器时可以避免端口冲突。</p><p>例如上面的启动命令可以改为 <code>docker run -p 80 nginx</code>,　这时如果我们本机的80端口被占用，docker就会自动的选择一个其他端口。我们可以通过 <code>docker ps</code> 或 <code>docker inspect</code>　命令来查看端口的映射关系。</p><p>-P 参数用法: <code>docker run -P nginx</code>.<br>-P 参数须配合　Dockerfile  一起使用，　能够将 Expose 声明的端口映射到宿主主机。</p><p>此时，使用 <code>docker inspect </code>命令，可以看到 dockerfile 中申明的端口都已经绑定到了主机上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;PortBindings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;443/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;HostPort&quot;</span>: <span class="string">&quot;443&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">        <span class="string">&quot;80/tcp&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;HostIp&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;HostPort&quot;</span>: <span class="string">&quot;80&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="expose-和-p-功能对比"><a href="#expose-和-p-功能对比" class="headerlink" title="-expose 和 -p 功能对比"></a>-expose 和 -p 功能对比</h4><p>我们可以通过如下的实验来更好的理解两参数之间的区别。</p><ul><li>不在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，也不通过 <code>-p</code> 参数指定</li><li>在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，但不使用 <code>-p</code> 参数</li><li>在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，也使用 <code>-p</code> 参数</li><li>在 <code>Dockerfile</code> 里 <code>EXPOSE</code>，也使用 <code>-P</code> 参数</li><li>只使用 <code>-p</code> 参数</li></ul><p><strong>结果</strong></p><ul><li>第一中情况: 不能在外网访问，也不能被 link 的 container 访问</li><li>第二种情况: 不能被外网访问，但是能被 link 的 container 访问</li><li>第三种情况: 能被外网访问，也能被 link 容器访问iw</li><li>第四种情况: 和第三种情况一样</li><li>第五种情况: 和第三种情况一样</li></ul><h3 id="Docker-端口映射原理"><a href="#Docker-端口映射原理" class="headerlink" title="Docker 端口映射原理"></a>Docker 端口映射原理</h3><p><strong>备注：</strong> 这一块挺乱的，我也没弄得很清楚，权当抛砖引玉了。</p><p>原本我理解端口映射是这样的一个通信过程：</p><ul><li>Docker进程启动的时候，会在宿主主机创建路由，同时创建docker0网桥</li><li>容器启动的时候创建 vethxx　的网卡，同时链接到网桥</li><li>通过 -p 参数指定端口映射后，　创建iptables规则</li><li>当有流量通过宿主主机端口进来用，通过iptables 匹配到规则后，转换为容器对应的子网ip</li><li>主机的路由指定了 172.xx　网段的ip由 docker0 处理</li><li>docker0再将请求转发到子网中容器</li></ul><p>后面和朋友了解了，发现还有　docker-proxy 的存在，于是，上面的理解是其实就片面的，不完善的。</p><hr><p>到现在，关于 Docker 端口映射的实现一共有2方案.</p><ul><li>1.7版本之前 docker-proxy + iptables DNAT 的方式<br>即，内网访问通过 iptables<br>外网访问通过 proxy</li><li>1.7版本之后的 iptables DNAT<br>完全由　iptables 实现</li></ul><p>Docker 1.7版本起，Docker提供了一个配置项： -userland-proxy，以让　Docker　用户决定是否启用　docker-proxy，默认为true，即启用docker-proxy。<br>现在的　Docker　环境默认的是： -userland-proxy&#x3D;true。iptables　和　docker-proxy　都会起作用。</p><p><strong>-userland-proxy&#x3D;true的情况下</strong></p><p>在启用 docker-proxy 的情况下。每设置一对端口映射就会启动一个 docker-proxy 进程。</p><p>可以通过 ps 命令查看 docker-proxy　进程信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep docker-proxy</span><br><span class="line"></span><br><span class="line">root      5532 19713  0 2月20 ?       00:00:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 443 -container-ip 172.19.0.8 -container-port 443</span><br><span class="line">root      5546 19713  0 2月20 ?       00:00:01 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 80 -container-ip 172.19.0.8 -container-port 80</span><br></pre></td></tr></table></figure><p>通过 sudo netstat -nltpu 查看本机的端口监听情况：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      5546/docker-proxy          </span><br><span class="line">tcp6       0      0 :::443                  :::*                    LISTEN      5532/docker-proxy</span><br></pre></td></tr></table></figure><p>通过上面的命令，会发现，我们映射到宿主机的端口被　docker-proxy　进程监听了。</p><p>别急，我们再看一下iptables，发现其中增加了对应的规则：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"> sudo iptables-save -t nat                 </span><br><span class="line"># Generated by iptables-save v1.6.1 on Fri Feb 22 15:06:17 2019</span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [55751:14743102]</span><br><span class="line">:INPUT ACCEPT [55615:14734886]</span><br><span class="line">:OUTPUT ACCEPT [260072:22717364]</span><br><span class="line">:POSTROUTING ACCEPT [260200:22725044]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.20.0.0/16 ! -o br-bf4c59b26d33 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.0/16 ! -o br-e2ab1d51063d -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.18.0.0/16 ! -o br-c9af812dc067 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.2/32 -d 172.19.0.2/32 -p tcp -m tcp --dport 6379 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.3/32 -d 172.19.0.3/32 -p tcp -m tcp --dport 27017 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.5/32 -d 172.19.0.5/32 -p tcp -m tcp --dport 3306 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.6/32 -d 172.19.0.6/32 -p tcp -m tcp --dport 9501 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.6/32 -d 172.19.0.6/32 -p tcp sudo iptables -t filter -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-USER  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain DOCKER (4 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.2           tcp dpt:6379</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.3           tcp dpt:27017</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.5           tcp dpt:mysql</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.6           tcp dpt:9501</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.6           tcp dpt:ssh</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.8           tcp dpt:https</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.8           tcp dpt:http</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (4 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  anywhere             anywhere -m tcp --dport 22 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.8/32 -d 172.19.0.8/32 -p tcp -m tcp --dport 443 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.19.0.8/32 -d 172.19.0.8/32 -p tcp -m tcp --dport 80 -j MASQUERADE</span><br><span class="line">-A DOCKER -i br-bf4c59b26d33 -j RETURN</span><br><span class="line">-A DOCKER -i br-e2ab1d51063d -j RETURN</span><br><span class="line">-A DOCKER -i br-c9af812dc067 -j RETURN</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 6379 -j DNAT --to-destination 172.19.0.2:6379</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 27017 -j DNAT --to-destination 172.19.0.3:27017</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 3306 -j DNAT --to-destination 172.19.0.5:3306</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 9501 -j DNAT --to-destination 172.19.0.6:9501</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 2222 -j DNAT --to-destination 172.19.0.6:22</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 443 -j DNAT --to-destination 172.19.0.8:443</span><br><span class="line">-A DOCKER ! -i br-e2ab1d51063d -p tcp -m tcp --dport 80 -j DNAT --to-destination 172.19.0.8:80</span><br></pre></td></tr></table></figure><p>这里的 <code>DOCKER</code> 对应的是由 docker　自定义的一组过滤规则，可以通过　<code>sudo iptables -t filter -L</code>　查看到:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -t filter -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-USER  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain DOCKER (4 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.2           tcp dpt:6379</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.3           tcp dpt:27017</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.5           tcp dpt:mysql</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.6           tcp dpt:9501</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.6           tcp dpt:ssh</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.8           tcp dpt:https</span><br><span class="line">ACCEPT     tcp  --  anywhere             172.19.0.8           tcp dpt:http</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (4 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">DROP       all  --  anywhere             anywhere            </span><br><span class="line">RETURN     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">RETURN     all  --  anywhere             anywhere </span><br></pre></td></tr></table></figure><p><strong>-userland-proxy&#x3D;false的情况下</strong></p><p>待研究~</p><p><strong>性能</strong></p><p>docker-proxy 在网络上吐槽的比较多，因为每一对端口映射都会对一个 docker-proxy进程，如果端口较多，可能就会带来性能问题。且在单个 docker-proxy 的情况下，性能比 iptables 略差。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>－ –link 能够访问　expose 声明的端口</p><ul><li>-expose 仅声明端口，并不会自动映射到宿主主机</li><li>-p 指定端口映射关系</li><li>-P 将 expose 声明的端口发布到宿主主机</li><li>在处理端口映射是，iptables　规则优先，如果没有匹配到iptables规则，则由 docker-proxy处理</li></ul><p><strong>待深入研究的问题：</strong></p><ul><li>container &lt;-&gt; container、host &lt;-&gt; container、 container &lt;-&gt; host　各自怎么选择策略的</li><li>iptables 规则</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这篇文章实在团队内部的分享，如下：&lt;/p&gt;
&lt;p&gt;今天的分享不包含故事背景、docker的发展与应用…&lt;/p&gt;
&lt;p&gt;分享源于对问题 ‘我已经在　Dockerfile 中通过 EXPOSE 指定了端口为何任然无法访问？’ 深入探索。其实今天的分享也可以视为对上一期峰哥分享的</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://www.wewx.cn/tags/docker/"/>
    
    <category term="容器" scheme="https://www.wewx.cn/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>PHP的编码规范</title>
    <link href="https://www.wewx.cn/2018/07/18/php-standard/"/>
    <id>https://www.wewx.cn/2018/07/18/php-standard/</id>
    <published>2018-07-18T02:36:48.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<p>版本：v1.0<br>日期：2018-10-10</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>为了更好的提高技术部的工作效率，保证开发的有效性和合理性，并可最大程度的提高程序代码的可读性和可重复利用性，指定此规范。</p><h3 id="整体要求"><a href="#整体要求" class="headerlink" title="整体要求"></a>整体要求</h3><p>本规范以 <a href="https://www.php-fig.org/psr/psr-2/">PSR2</a> 规范为基础制定,是 <a href="https://www.php-fig.org/psr/psr-2/">PSR2</a> 规范的继承与扩展。</p><p>新项目需完全遵守本规范，之前旧系统代码可以可以继续遵守原有的规范。</p><h3 id="「能愿动词」的使用"><a href="#「能愿动词」的使用" class="headerlink" title="「能愿动词」的使用"></a>「能愿动词」的使用</h3><p>为了避免歧义，文档大量使用了「能愿动词」(<a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>)，对应的解释如下：</p><ul><li>必须 (MUST)：绝对，严格遵循，请照做，无条件遵守；</li><li>一定不可 (MUST NOT)：禁令，严令禁止；</li><li>应该 (SHOULD) ：强烈建议这样做，但是不强求；</li><li>不该 (SHOULD NOT)：强烈不建议这样做，但是不强求；</li></ul><h2 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h2><h3 id="1-关于-PHP-版本选择"><a href="#1-关于-PHP-版本选择" class="headerlink" title="1. 关于 PHP 版本选择"></a>1. 关于 PHP 版本选择</h3><ul><li><strong>必须</strong> 使用 <code>PHP 7.0</code> 以上的版本。</li><li><strong>应该</strong> 使用最新的稳定版本。</li></ul><h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><ul><li>源文件 <strong>必须</strong> 只使用 <code>&lt;?php</code>。</li><li>源文件中 PHP 代码的编码格式 <strong>必须</strong> 只使用 <code>不带 BOM 的 UTF-8</code>。</li><li>源文件在文件结尾处 <strong>必须</strong> 忽略掉 <code>?&gt;</code> 且 <strong>必须</strong> 以一个空行结尾。</li><li>类定义文件 <strong>必须</strong> 使用类名作为文件名, 用首字母大写。</li><li>类文件 <strong>必须</strong> 使用命名空间为路径存储。</li><li>除类文件外，其他文件全部用小写字母加下划线命名。</li></ul><h3 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h3><ul><li>源文件中 <strong>必须</strong> 声明为严格模式 <code>declare(strict_types=1);</code>。</li><li><strong>必须</strong> 为类方法和函数声明参数类类型、返回值类型。</li><li>一个类方法和函数 <strong>必须</strong> 只有一种类型的返回参数。</li></ul><h3 id="基础规范"><a href="#基础规范" class="headerlink" title="基础规范"></a>基础规范</h3><ul><li>一个源文件 <strong>应该</strong> 只用来做声明（类，函数，常量等）或者只用来做一些辅助作用的操作（例如：输出信息，修改 .ini 配置等），但不应当同时做这两件事。</li><li>类名 <strong>必须</strong> 使用 <code>StudlyCaps</code> 写法,比如 <code>SampleController</code>。</li><li>类中的常量 <strong>必须</strong> 只由大写字母和下划线(_)组成。</li><li>方法名 <strong>必须</strong> 使用 <code>camelCase（驼峰式)</code> 写法，比如 <code>getTotalById</code>。</li><li>变量名 <strong>必须</strong> 使用 <code>camelCase（驼峰式)</code> 写法。</li><li>代码 <strong>必须</strong> 使用 4 个空格符进行缩进。<br>  备注: 使用空格而不是 <code>tab</code> 键 缩进的好处在于，避免在比较代码差异、打补丁、重阅代码以及注释时产生混淆。并且，使用空格缩进，让对齐变得更方便。</li><li>关键字 以及 <code>true</code> &#x2F; <code>false</code> &#x2F; <code>null</code><br>  PHP 所有关键字 <strong>必须</strong> 全部小写。<br>  常量 <code>true</code> 、<code>false</code> 和 <code>null</code> 也必须全部小写。</li><li>运算符(<code>=, +, -, *, /, %, +=</code>等等)左右两边 <strong>必须要有</strong> 一个空格。</li><li><strong>应该</strong> 使用 <code>===</code> 运算符代替 <code>==</code> 运算符，应该使用 <code>true</code> &#x2F; <code>false</code> 常来代替 <code>1</code> &#x2F; <code>0</code>。</li><li>每行 <strong>一定不可</strong> 有多条语句。</li><li>非空行后 <strong>一定不可</strong> 有多余的空格。</li><li>运算表达式可以在运算符处换行，且运算符应 <strong>该放</strong> 在下一行的开始。</li><li>缩写词（含专有名词）与其他词组合命名， <strong>必须</strong> 使用 <code>camelCase（驼峰式)</code> 写法，如： <code>ApiUrl</code>。</li></ul><h3 id="行-与-空行"><a href="#行-与-空行" class="headerlink" title="行 与 空行"></a>行 与 空行</h3><ul><li>每行的字符数 <strong>应该</strong> 保持在 80 个以内， 通常情况 <strong>不该</strong> 超过 120 个。如果换行可能破坏语意或降低可阅读性，可作为例外超出限制。</li><li>代码块开始之前与结束符 <code>&#125;</code> 之后，<strong>应该</strong> 有一个空行。</li><li>方法和函数的 <code>return</code> 语句之前，<strong>应该</strong> 有一个空行。</li><li>完成一定功能的代码块前后，<strong>应该</strong> 各有一个空行。</li><li><strong>一定不可</strong> 存在连续的 2 个以上的空行。</li></ul><h3 id="类、Interface、Trait"><a href="#类、Interface、Trait" class="headerlink" title="类、Interface、Trait"></a>类、Interface、Trait</h3><ul><li><p>每个 <code>namespace</code> 命名空间声明语句和 <code>use</code> 声明语句块后面，必须插入一个空白行。所有 <code>use</code> <strong>必须</strong> 在 <code>namespace</code> 后声明。每条 <code>use</code> 声明语句 <strong>必须</strong> 只有一个 <code>use</code> 关键词。<code>use</code> 声明语句块后 <strong>必须</strong> 要有一个空白行。例如：</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">FooClass</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">BarClass</span> <span class="keyword">as</span> <span class="title">Bar</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">OtherVendor</span>\<span class="title">OtherPackage</span>\<span class="title">BazClass</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... additional PHP code ...</span></span><br></pre></td></tr></table></figure></li><li><p>扩展与继承，关键词 <code>extends</code> 和 <code>implements</code>  <strong>必须</strong> 写在类名称的同一行，类的开始花括号 <strong>必须</strong> 独占一行，结束花括号也 <strong>必须</strong> 在类主体后独占一行。例如:</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">FooClass</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">BarClass</span> <span class="keyword">as</span> <span class="title">Bar</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">OtherVendor</span>\<span class="title">OtherPackage</span>\<span class="title">BazClass</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span> <span class="keyword">extends</span> <span class="title">ParentClass</span> <span class="keyword">implements</span> <span class="title">ArrayAccess</span>, <span class="title">Countable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// constants, properties, methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <code>implements</code> 的继承列表也可以分成多行，这样的话，每个继承接口名称都 <strong>必须</strong> 分开独立成行，包括第一个。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">FooClass</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">BarClass</span> <span class="keyword">as</span> <span class="title">Bar</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">OtherVendor</span>\<span class="title">OtherPackage</span>\<span class="title">BazClass</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span> <span class="keyword">extends</span> <span class="title">ParentClass</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class">    <span class="title">ArrayAccess</span>,</span></span><br><span class="line"><span class="class">    <span class="title">Countable</span>,</span></span><br><span class="line"><span class="class">    <span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// constants, properties, methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>类的开始花括号(<code>&#123;</code>) <strong>必须</strong> 写在函数声明后自成一行，结束花括号(<code>&#125;</code>)也 <strong>必须</strong> 写在函数主体后自成一行。</p></li><li><p>方法的开始花括号(<code>&#123;</code>) <strong>必须</strong> 写在函数声明后自成一行，结束花括号(<code>&#125;</code>) <strong>也必须</strong> 写在函数主体后自成一行。<br>  一个标准的方法声明可参照以下范例，留意其括号、逗号、空格以及花括号的位置。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fooBarBaz</span>(<span class="params"><span class="variable">$arg1</span>, &amp;<span class="variable">$arg2</span>, <span class="variable">$arg3</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// method body</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>类的属性和方法必须添加访问修饰符（<code>private</code>、<code>protected</code> 以及 <code>public</code>）， <code>abstract</code> 以及 <code>final</code> 必须声明在访问修饰符之前，而 <code>static</code> <strong>必须</strong> 声明在访问修饰符之后。<br>  以下是属性声明的一个范例：</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$foo</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  需要添加 <code>abstract</code> 或 <code>final</code> 声明时， <strong>必须</strong> 写在访问修饰符前，而 <code>static</code> 则 <strong>必须</strong> 写在其后。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="variable">$foo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">zim</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// method body</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>类的属性和方法 <strong>一定不可</strong> 使用 <code>_</code> 开头命名来区分私有方法。</p></li><li><p>方法的参数声明过多时，每个参数可以独占一行</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReturnTypeVariations</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">anotherFunction</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">string</span> <span class="variable">$foo</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">string</span> <span class="variable">$bar</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">int</span> <span class="variable">$baz</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="类方法与函数"><a href="#类方法与函数" class="headerlink" title="类方法与函数"></a>类方法与函数</h3><ul><li><p>参数和变量列表中逗号(，)前 <strong>必须不能有</strong> 空格，而逗号后 <strong>必须要有</strong> 空格。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"><span class="variable">$arg1</span>, &amp;<span class="variable">$arg2</span>, <span class="variable">$arg3</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// method body</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>参数列表可以分列成多行，这样，包括第一个参数在内的每个参数都 <strong>必须</strong> 单独成行。<br>  拆分成多行的参数列表后，结束括号以及方法开始花括号 <strong>必须</strong> 写在同一行，中间用一个空格分隔。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aVeryLongMethodName</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        ClassTypeHint <span class="variable">$arg1</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        &amp;<span class="variable">$arg2</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">array</span> <span class="variable">$arg3</span> = []</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>) </span>&#123;</span><br><span class="line">        <span class="comment">// method body</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>方法及函数调用时，方法名或函数名与参数左括号之间 <strong>一定不可</strong> 有空格，参数右括号前也 <strong>一定不可</strong> 有空格。每个参数前 <strong>一定不可</strong> 有空格，但参数 <code>，</code> 之后 <strong>必须</strong> 有一个空格。</p></li></ul><h3 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h3><ul><li><p>控制结构的基本规范如下</p><ul><li>控制结构的关键字后 <strong>必须</strong> 要有一个空格符，而调用方法或函数时则一定不能有。</li><li>控制结构的开始花括号(<code>&#123;</code>) <strong>必须</strong> 写在声明的同一行，而结束花括号(<code>&#125;</code>)必须写在主体后自成一行。</li><li>控制结构的开始左括号后和结束右括号前，都 <strong>一定不可</strong> 有空格符。</li></ul></li><li><p><code>case</code> 语句 <strong>必须</strong> 相对 <code>switch</code> 进行一次缩进，而 <code>break</code> 语句以及 <code>case</code> 内的其它语句都 <strong>必须</strong> 相对 <code>case</code> 进行一次缩进。<br>如果存在非空的 <code>case</code> 直穿语句，主体里 <strong>必须</strong> 有类似 <code>// no break</code> 的注释。例如:</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$expr</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;First case, with a break&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Second case, which falls through&#x27;</span>;</span><br><span class="line">        <span class="comment">// no break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Third case, return instead of break&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Default case&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>应该</strong> 使用关键词 <code>elseif</code> 代替所有 <code>else if</code>，以使得所有的控制关键字都像是单独的一个词。例如:</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$expr1</span>) &#123;</span><br><span class="line">    <span class="comment">// if body</span></span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="variable">$expr2</span>) &#123;</span><br><span class="line">    <span class="comment">// elseif body</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// else body;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>while 和 do while。一个规范的 while 语句 <strong>应该</strong> 如下所示，注意其 括号、空格以及花括号的位置。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$expr</span>) &#123;</span><br><span class="line">    <span class="comment">// structure body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>标准的 <code>do while</code> 语句如下所示，同样的，注意其 括号、空格以及花括号的位置。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// structure body;</span></span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="variable">$expr</span>);</span><br></pre></td></tr></table></figure></li><li><p>标准的 <code>for</code> 语句如下所示，注意其括号、空格以及花括号的位置。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="comment">// for body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>标准的 <code>foreach</code> 语句如下所示，注意其括号、空格以及花括号的位置。例如:</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$iterable</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="comment">// foreach body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>标准的 <code>try catch</code> 语句如下所示，注意其括号、空格以及花括号的位置。例如:</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// try body</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (FirstExceptionType <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="comment">// catch body</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (OtherExceptionType <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="comment">// catch body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><ul><li><p>闭包声明时，关键词 <code>function</code> 后以及关键词 <code>use</code> 的前后都必须要有一个空格。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$closureWithArgs</span> = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// body</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$closureWithArgsAndVars</span> = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$var1</span>, <span class="variable">$var2</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// body</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$closureWithArgsVarsAndReturn</span> = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$var1</span>, <span class="variable">$var2</span></span>): <span class="title">bool</span> </span>&#123;</span><br><span class="line">    <span class="comment">// body</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$longArgs_longVars</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="variable">$longArgument</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="variable">$longerArgument</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="variable">$muchLongerArgument</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) <span class="keyword">use</span> (<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="variable">$longVar1</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="variable">$longerVar2</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="variable">$muchLongerVar3</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// body</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$foo</span>-&gt;<span class="title function_ invoke__">bar</span>(</span><br><span class="line">    <span class="variable">$arg1</span>,</span><br><span class="line">    function (<span class="variable">$arg2</span>) <span class="keyword">use</span> ($<span class="title">var1</span>) &#123;</span><br><span class="line">        // <span class="title">body</span></span><br><span class="line">    &#125;,</span><br><span class="line">    $<span class="title">arg3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>开始花括号 <strong>必须</strong> 写在声明的同一行，结束花括号 <strong>必须</strong> 紧跟主体结束的下一行。</p></li><li><p>同事遵守 <code>函数</code> 和 <code>类方法</code> 的相关原则。</p></li></ul><h3 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h3><ul><li><p>匿名类 <strong>必须</strong> 遵守 <code>闭包</code> 和 <code>类</code> 的相关原则。</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$instance</span> = <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> \<span class="title">Foo</span> <span class="keyword">implements</span> \<span class="title">HandleableInterface</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Class content</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$instance</span> = <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> \<span class="title">Foo</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class">    \<span class="title">ArrayAccess</span>,</span></span><br><span class="line"><span class="class">    \<span class="title">Countable</span>,</span></span><br><span class="line"><span class="class">    \<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// Class content</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><ul><li><p>文件头部注释 (可选)</p><ul><li><code>author</code>： 作者以及联系邮箱。</li><li><code>createTime</code>：文件创建时间 - 可以通过git来追踪。</li><li><code>description</code>：当前文件的详细介绍。</li></ul>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* createTime : 18-10-8 12:23</span></span><br><span class="line"><span class="comment">* description: 测试通知服务</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li><li><p>方法注释 (可选)<br>  使用 <code>PHPdoc</code> 方式，描述方法功能、参数等。</p><ul><li><code>@param</code> 参数，语法：<code>@param [&quot;Type&quot;] [name] [&lt;description&gt;]</code>，标签用于记录函数或方法的单个参数，且可以有多行描述，不需要明确的分隔。</li><li><code>@return</code> 返回，语法：<code>@return &lt;&quot;Type&quot;&gt; [description]</code>，标签用于记录函数或方法的返回类型，同样支持多行描述。</li><li><code>@throws</code> 参数，语法：<code>@throws [Type] [&lt;description&gt;]</code>，标签用于记录函数或方法的抛出的错误异常，注明发生情况。</li></ul>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建商户 union_id</span></span><br><span class="line"><span class="comment"> * - 向 points_account 插入一条数据，获取 id</span></span><br><span class="line"><span class="comment"> * - 使用该 id 向 account base service 申请 union_id</span></span><br><span class="line"><span class="comment"> * - 更新记录</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int $roleType 角色类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> PointsAccount 账号 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> \Throwable 生成 union_id 或者 创建账号失败抛出异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">generateUnionIdAndCreateAccount</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$roleType</span></span>): <span class="title">PointsAccount</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>变量注释 (可选)</p><ul><li><code>@var</code> 变量，语法：<code>@var [&quot;Type&quot;] [element_name] [&lt;description&gt;]</code>，标签用于记录变量类型，也用于记录常量等</li></ul>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> integer 待审核</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATUS_PENDING</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li></ul><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Vendor</span>\<span class="title class_">Package</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Vendor</span>\<span class="title">Package</span>\&#123;<span class="title">ClassA</span> <span class="keyword">as</span> <span class="title">A</span>, <span class="title">ClassB</span>, <span class="title">ClassC</span> <span class="keyword">as</span> <span class="title">C</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Vendor</span>\<span class="title">Package</span>\<span class="title">SomeNamespace</span>\<span class="title">ClassD</span> <span class="keyword">as</span> <span class="title">D</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">function</span> <span class="title">Vendor</span>\<span class="title">Package</span>\&#123;<span class="title">functionA</span>, <span class="title">functionB</span>, <span class="title">functionC</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">const</span> <span class="title">Vendor</span>\<span class="title">Package</span>\&#123;<span class="title">ConstantA</span>, <span class="title">ConstantB</span>, <span class="title">ConstantC</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">Bar</span> <span class="keyword">implements</span> <span class="title">FooInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sampleFunction</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$a</span>, <span class="keyword">int</span> <span class="variable">$b</span> = <span class="literal">null</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span> === <span class="variable">$b</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">bar</span>();</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$a</span> &gt; <span class="variable">$b</span>) &#123;</span><br><span class="line">            <span class="variable">$foo</span>-&gt;<span class="title function_ invoke__">bar</span>(<span class="variable">$arg1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">BazClass</span>::<span class="title function_ invoke__">bar</span>(<span class="variable">$arg2</span>, <span class="variable">$arg3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// method body</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;版本：v1.0&lt;br&gt;日期：2018-10-10&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;h3 id=&quot;目的&quot;&gt;&lt;a href=&quot;#目的&quot; class=&quot;headerli</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>关于 MySQL InnoDB 引擎的索引知识</title>
    <link href="https://www.wewx.cn/2018/06/01/indexing-knowledge-about-the-mysql-innodb-engine/"/>
    <id>https://www.wewx.cn/2018/06/01/indexing-knowledge-about-the-mysql-innodb-engine/</id>
    <published>2018-06-01T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<p>这边文章在草稿箱放了整整１年半啊.</p><h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><p>从 MySQL 5.5.5 版本开始 InnoDB 是 Mysql 的默认存储引擎。</p><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="支持的索引"><a href="#支持的索引" class="headerlink" title="支持的索引"></a>支持的索引</h3><ul><li>支持全文索引</li><li>支持 B+ 树索引</li><li>支持 hash 索引</li></ul><p>其中 hash 索引是完全自动的，不能人工干预，InnoDB 引擎会监控表上各个索引页的查询，如果观察到建立 hash 索引可以带来速度提升，则自动建立 hash 索引</p><p><strong>B+ 树索引</strong><br>就是我们所说的索引。<br>B+ 树索引不能直接找到具体数据的行，只能找到数据所在的页，数据库通过把也度入到内存，在内存中查找，最后得到数据。</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h4 id="树"><a href="#树" class="headerlink" title="树"></a>树</h4><p>二叉树：每个节点有两个子节点，数据量的增大必然导致高度的快速增加。<br>搜索二叉树：左子树小于根，右子树大于根。<br>平衡二叉树：2 棵子树的高度差为 1（查找效率共，但维护成本也高）。<br>B树：是一种自平衡的树。概括来说是一个一般化的二叉查找树，可以拥有多于 2 个子节点（也是 MyISAM  参考的数据结构，ISAM：索引顺序存取方法）。</p><p>B+ 树： 通过二叉查找树，再由平衡二叉树，B 树演化来的。因此，B+ 树也是一种平衡树。</p><p><img src="https://ws1.sinaimg.cn/large/006CUA5Vgy1fzme91elfej30m80a8q4h.jpg"></p><p>⤴️ 高度为2 每页可存放3条记录的B+树。</p><p>B+ 树元素自底向上插入。所有记录节点都是按键值的大小顺序存放在同一层叶子节点上，由各叶子节点指针进行连接。</p><h4 id="B-树的插入操作"><a href="#B-树的插入操作" class="headerlink" title="B+ 树的插入操作"></a>B+ 树的插入操作</h4><p>节点未满：直接插入。</p><p>节点已满：这时候需要分裂。当一个结点满时，分配一个新的结点，并将原结点中 1&#x2F;2 的数据复制到新结点，最后在父结点中增加新结点的指针；B+ 树的分裂只影响原结点和父结点，而不会影响兄弟结点，所以它不需要指向兄弟节点的指针</p><h4 id="B-树的删除操作"><a href="#B-树的删除操作" class="headerlink" title="B+ 树的删除操作"></a>B+ 树的删除操作</h4><p>直接删除：如果不是 Page Index 节点，则直接删除。<br>删除 Page Index 节点： 直接删除，使用右边的节点作为 Page Index， 同事更新父节点。<br>合并：删除后，节点数量小于 50%，则和兄弟节点合并。同时更新父节点。</p><h4 id="B-树的查找"><a href="#B-树的查找" class="headerlink" title="B+ 树的查找"></a>B+ 树的查找</h4><p><img src="https://ws1.sinaimg.cn/large/006CUA5Vgy1fzmearrmt8j30fi04vwet.jpg" alt="B+ 树的查找示意图"></p><p>通常向下读取一个节点的动作可能会是一次磁盘IO操作，不过非叶节点通常会在初始阶段载入内存以加快访问速度。同时为提高在节点间横向遍历速度，真实数据库中可能会将图中蓝色的CPU计算&#x2F;内存读取优化成二叉搜索树。</p><h3 id="InnoDB-的索引"><a href="#InnoDB-的索引" class="headerlink" title="InnoDB 的索引"></a>InnoDB 的索引</h3><h4 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h4><p>InnoDB使用的是聚集索引，就是按照每张表的主键构建一颗B+树，叶子节点中存放的整张表的行记录数据（数据页）。各数据页之间使用双向链表连接。</p><p>聚集索引即是主键。<br>每张表只能有用一个聚集索引。<br>数据在逻辑上是顺序的，物理上不是顺序存储的。<br>聚集索引的排序、查找、范围查找非常快。</p><h4 id="辅助索引"><a href="#辅助索引" class="headerlink" title="辅助索引"></a>辅助索引</h4><p>也称非聚集索引。叶子节点不包含行记录的全部数据。叶子节点除了包含键值以外，还包含一个数钱，用来告诉引擎在哪里找到数据（指向到聚集索引）。<br>辅助索引不影响数据在聚集索引中的组织，因此，一张表可以包含多个辅助索引。</p><p>假设辅助索引树高3层，聚集索引树为3层。辅助索引 B+ 树中检索 name，需要先经过3次 IO 到达其叶子节点获取对应的主键。接着再经过3次 IO 使用主键在聚集索引 B+ 树中再执行一次 B+ 树检索操作，最终到达叶子节点即可获取整行数据。</p><p>聚簇索引的优势:</p><ul><li>行数据和叶子节点存储在一起，这样主键和行数据是一起被载入内存的，找到叶子节点就可以立刻将行数据返回。</li><li>保证不管这个主键B+树的节点如何变化，辅助索引树都不受影响。</li></ul><h2 id="正确建立索引"><a href="#正确建立索引" class="headerlink" title="正确建立索引"></a>正确建立索引</h2><ul><li><p>最左前缀匹配</p></li><li><p>&#x3D; 和 in 可以乱序， MySQL 的查询优化器会帮你优化成索引可以识别的形式</p></li><li><p>尽量选择区分度高的列作为索引（Cardinality 值），区分度的公式是  <code>count(distinct col)/count(*)</code> ，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1</p><ul><li><code>show index from user</code> 可查看 Cardinality 值（采样统计，非实时）</li><li><img src="https://ws1.sinaimg.cn/large/006CUA5Vgy1fzme9yvis3j31lg09mq58.jpg" alt="Cardinality 值"></li></ul></li><li><p>索引列不能参与计算</p></li><li><p>尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这边文章在草稿箱放了整整１年半啊.&lt;/p&gt;
&lt;h2 id=&quot;InnoDB&quot;&gt;&lt;a href=&quot;#InnoDB&quot; class=&quot;headerlink&quot; title=&quot;InnoDB&quot;&gt;&lt;/a&gt;InnoDB&lt;/h2&gt;&lt;p&gt;从 MySQL 5.5.5 版本开始 InnoDB 是 M</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="MySQL" scheme="https://www.wewx.cn/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 分区表探索</title>
    <link href="https://www.wewx.cn/2017/12/08/mySQL-partitioned-table-exploration/"/>
    <id>https://www.wewx.cn/2017/12/08/mySQL-partitioned-table-exploration/</id>
    <published>2017-12-08T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>如果需要定时清理一张普通大表里的历史数据。</p><p>可以使用一个或多个带 where 条件的 delete 语句去删除（where条件是时间）。 如果表数据量较大，这对数据库的造成了很大压力。即使我们把这些旧数据删除了，但是底层的数据文件并没有变小。</p><blockquote><p>为什么没有变小？<br>当删除数据 时，MYSQL 并不会立即回收表空间。被已删除数据的占据的存储空间，以及索引位会空在那里，等待新的数据来弥补这个空缺。<br>强行回收： OPTIMIZE TABLE</p></blockquote><p>面对这类问题，其实最有效的方法就是在使用分区表。分区表最大的优点就是可以非常高效的进行历史数据的清理。</p><h2 id="关于分区表"><a href="#关于分区表" class="headerlink" title="关于分区表"></a>关于分区表</h2><p>分区表不是在存储引擎层完成的。这是 MySQL 支持的功能（5.1开始）</p><p>原理：<br>将表索引分解为多个更小、更可管理的部分。</p><p>从逻辑上讲，只有一个表或者索引，但是物理上这个表或者索引可能由数十个物理分区组成。</p><p>分区表最大的优点就是可以非常高效的进行历史数据的清理。</p><p>每个分区都是独立的对象，可以独自处理，也可以作为一个更大对象的一部分进行处理（如果分区表很大，亦可以将分区分配到不同的磁盘上去）。</p><p>在执行查询的时候，优化器会根据分区定义过滤哪些没有我们需要数据的分区，这样查询就无须全表扫描所有分区，只查找包含需要数据的分区即可。</p><h2 id="检查分区功能是否启用"><a href="#检查分区功能是否启用" class="headerlink" title="检查分区功能是否启用"></a>检查分区功能是否启用</h2><pre><code>mysql&gt; SHOW PLUGINS \G;*************************** 43. row ***************************   Name: partition Status: ACTIVE   Type: STORAGE ENGINELibrary: NULLLicense: GPL</code></pre><h2 id="分区类型"><a href="#分区类型" class="headerlink" title="分区类型"></a>分区类型</h2><p>MySQL目前只支持 水平分区（水平分区就是将不同的行分配到不同的物理文件中）。</p><ul><li><p>范围分区（RANGE）<br>行数据基于一个给定的连续区间的值被放入分区。</p></li><li><p>列表分区（LIST）<br>和 RANGE 分区类似，只不过面向的是离散的值。</p></li><li><p>哈希分区（HASH）<br>根据用户自定义的表达式返回的值来区分放入那个分区。</p></li><li><p>KEY分区<br>根据 MySQL 数据库提供的哈希函数来进行分区。</p></li><li><p>COLUMNS 分区<br>可以对多个列的值进行分区。（MySQL 5.5+ 开始支持）。</p></li></ul><h2 id="RANGE-分区"><a href="#RANGE-分区" class="headerlink" title="RANGE 分区"></a>RANGE 分区</h2><p>这是最常用的一种分区类型。最常见的是基于时间字段（基于分区的列最好是整型）来分区。<br>分区的列可以允许 null 值，如果分区的列值是 null，则会选择第一个分区。</p><pre><code>CREATE TABLE range_partition_test (    id INT,    pdate INT)PARTITION BY RANGE (pdate) (    PARTITION p1 VALUES LESS THAN ( 201702 ),    PARTITION p2 VALUES LESS THAN ( 201703 ),    PARTITION p3 VALUES LESS THAN ( 201704 ),    PARTITION p4 VALUES LESS THAN (MAXVALUE));</code></pre><p><code>MAXVALUE</code> 是一个无穷大的值，所以p4 分区即为默认的分区。</p><p>在执行查询的时候，带上分区字段，这样可以使用分区剪裁功能。</p><pre><code>mysql&gt; select * from range_partition_test;+------+--------+| id   | pdate  |+------+--------+|    1 | 201701 ||    2 | 201702 ||    3 | 201703 ||    4 | 201704 ||    5 | 201705 |+------+--------+mysql&gt; explain partitions select * from range_partition_test where pdate between 201702 and 201703;+----+-------------+----------------------+------------+------+---------------+------+---------+------+------+----------+-------------+| id | select_type | table                | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |+----+-------------+----------------------+------------+------+---------------+------+---------+------+------+----------+-------------+|  1 | SIMPLE      | range_partition_test | p2,p3      | ALL  | NULL          | NULL | NULL    | NULL |    2 |    50.00 | Using where |+----+-------------+----------------------+------------+------+---------------+------+---------+------+------+----------+-------------+</code></pre><p>只查询了p2,p3分区。</p><h2 id="LIST-分区"><a href="#LIST-分区" class="headerlink" title="LIST 分区"></a>LIST 分区</h2><p>LIST 分区和 RANGE 分区类似。<br>区别在于 LIST 是枚举值列表的集合，RANGE 是连续的区间值的集合。二者在语法方面非常的相似。<br>建议 LIST 分区列是非 null 列，否则插入 null 值如果枚举列表里面不存在 null 值会插入失败（和 RANGE 分区不一样）。</p><pre><code>CREATE TABLE list_partition_test (    id INT,    pdate INT)PARTITION BY LIST (pdate) (    PARTITION p1 VALUES IN (1,3,5,7,9),    PARTITION p2 VALUES IN (2,4,6,8,0));</code></pre><h2 id="Hash-分区"><a href="#Hash-分区" class="headerlink" title="Hash 分区"></a>Hash 分区</h2><p>HASH 分区的目的是讲数据均匀的分不到预先定义的各个分区中。保证各个分区的记录数量大体上都是一致的。</p><p>在实际工作中经常遇到像会员表的这种表。并没有明显可以分区的特征字段。但表数据有非常庞大。这时候可以使用 HASH 分区。</p><p>基于给定的分区个数，将数据分配到不同的分区，HASH分区只能针对整数进行 HASH。</p><pre><code>CREATE TABLE hash_partition_test (    id INT,    pdate INT)PARTITION BY HASH(id)PARTITIONS 4;</code></pre><ul><li>上面的分区对象(id)也可以是一个表达式，表达式的结果必须是整数值。</li><li>HASH 分区可以不用指定 PARTITIONS 子句，则默认分区数为1。</li><li>不允许只写 PARTITIONS，而不指定分区数。</li><li>HASH 分区的底层实现其实是基于 MOD 函数。</li></ul><h2 id="KEY-分区"><a href="#KEY-分区" class="headerlink" title="KEY 分区"></a>KEY 分区</h2><p>KEY 分区和 HASH 分区相似。不同之处在于：</p><ul><li>KEY 分区允许多列，而 HASH 分区只允许一列。</li><li>如果在有主键或者唯一键的情况下，key 中分区列可不指定，默认为主键或者唯一键，如果没有，则必须显性指定列。</li><li>KEY 分区对象必须为列，而不能是基于列的表达式。</li><li>KEY 分区和 HASH 分区的算法不一样，对于 innodb 引擎，采用的是 MD5 值来分区。</li></ul><h2 id="COLUMNS-分区"><a href="#COLUMNS-分区" class="headerlink" title="COLUMNS 分区"></a>COLUMNS 分区</h2><p>可以直接使用非整型的数据进行分区。分区根据类型直接比较而得，不需要转化为整型。同时，可以对多个列值进行分区。</p><pre><code>CREATE TABLE listvardou (    id INT,    pdate INT)PARTITION BY LIST COLUMNS(id,pdate)(    PARTITION a VALUES IN ( (1, 201701), (1, 201702), (1, 201703)),    PARTITION b VALUES IN ( (2, 201702) )    PARTITION b VALUES IN ( (3, 201703) ));</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>RANGE 分区，LIST 分区，HASH 分区，KEY 分区对象返回的只能是整数值，如果不是整型，则需要使用函数将其转化为整型。</li><li>数据表非常大以至于无法全部都放到内存，或者只在表的最后部分有热点数据，其他均为历史数据的情况下，可以选用分区表。</li><li>分区表数据更容易维护（可独立对分区进行优化、检查、修复及批量删除大数据可以采用drop分区的形式等）。</li><li>分区表的数据可以分布在不同的物理设备上，从而高效地利用多个硬件设备。</li><li>可以备份和恢复独立的分区，非常适用于大数据集的场景。</li><li>分区的主要目的是用于数据库的高可用性管理。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;如果需要定时清理一张普通大表里的历史数据。&lt;/p&gt;
&lt;p&gt;可以使用一个或多个带 where 条件的 delete 语句去删除（where条件</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="MySQL" scheme="https://www.wewx.cn/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>记一次由于磁盘 Inode 用满导致的故障</title>
    <link href="https://www.wewx.cn/2017/10/01/remember-a-fault-due-to-full-disk-inode/"/>
    <id>https://www.wewx.cn/2017/10/01/remember-a-fault-due-to-full-disk-inode/</id>
    <published>2017-10-01T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在一台ubuntu服务器上运行了多个laravel项目</p><h2 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h2><p>昨天早上有客户提醒服务不可用。排查后发现是磁盘满了（100G）。删除掉40G的备份文件后，服务恢复正常。</p><p>但是今天早上，又有很多客户反应服务挂掉了。</p><p>查看日志，发现有大量的 failed to open stream: No space left on device 的错误。使用 df -h 查看，磁盘明明还有40G空间，按道理不应该出现这个错误。</p><h2 id="查找问题"><a href="#查找问题" class="headerlink" title="查找问题"></a>查找问题</h2><p>磁盘空间明明还有，但提示空间不足。遂使用 df -ih 查看了一下 inode 的使用情况。</p><pre><code>➜  ~ df -ihFilesystem     Inodes IUsed IFree IUse% Mounted onudev             490K   437  490K    1% /devtmpfs            494K   944  494K    1% /run/dev/vda1        2.5M  102K  2.5M    4% /tmpfs            494K     1  494K    1% /dev/shmtmpfs            494K     2  494K    1% /run/locktmpfs            494K    16  494K    1% /sys/fs/cgroup/dev/vdb1        6.3M  6.3M  1.3M. 100% /mnt/vdb</code></pre><p>发现 inode 已经用满了，从而导致系统无法创建文件。以至于系统抛出 No space left on device 错误。</p><p>inode是什么？</p><blockquote><p>理解inode，要从文件储存说起。</p></blockquote><blockquote><p>文件储存在硬盘上，硬盘的最小存储单位叫做”扇区”（Sector）。每个扇区储存512字节（相当于0.5KB）。</p></blockquote><blockquote><p>操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个”块”（block）。这种由多个扇区组成的”块”，是文件存取的最小单位。”块”的大小，最常见的是4KB，即连续八个 sector组成一个 block。</p></blockquote><blockquote><p>文件数据都储存在”块”中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为”索引节点”。</p></blockquote><blockquote><p>每一个文件都有对应的inode，里面包含了与该文件有关的一些信息。</p></blockquote><p>引用自：<a href="http://www.ruanyifeng.com/blog/2011/12/inode.html">http://www.ruanyifeng.com/blog/2011/12/inode.html</a></p><p>因此，为题就是磁盘的 block 空间还有剩余，但是 inode 空间用完，无法继续创建新文件。</p><h2 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h2><p>在运行的几个 laravel 项目中，有2个访问量很大，而且有写缓存（CACHE_DRIVER&#x3D;file)。</p><p>进入到laravel项目的 storeage&#x2F;framework&#x2F;cache&#x2F;data 目录下，发现存在大量的文件夹，里面存储的是大量的小文件（一个文件只有几KB）。</p><p>这些大量的小文件并没有占用多少 block 空间，却吧 inode 空间占满了。</p><h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><ol><li><p>删除项目的 Cache 文件<br>停止 nginx、 php-fpm，进入 data 目录，执行：rm -rf .&#x2F;*<br>然后悲剧了，系统卡死， 10分钟、半小时、1小时…，没办法，只能先清理一部分出来，晚上再删。</p></li><li><p>切换缓存到 redis（阿里云的云服务）</p></li><li><p>搞一个脚本，每晚定时清理。</p></li><li><p>挂在新的磁盘，软连接到 cache 目录，以缓解单块磁盘的inode空间不足的问题。（计划实施）</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;在一台ubuntu服务器上运行了多个laravel项目&lt;/p&gt;
&lt;h2 id=&quot;发现问题&quot;&gt;&lt;a href=&quot;#发现问题&quot; class=&quot;h</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="Linux" scheme="https://www.wewx.cn/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>https背后的内幕</title>
    <link href="https://www.wewx.cn/2017/04/10/explor-https/"/>
    <id>https://www.wewx.cn/2017/04/10/explor-https/</id>
    <published>2017-04-10T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>这是一篇内部分享文</p></blockquote><p><img src="https://cdn.learnku.com/uploads/images/201702/06/4949/nx3raoaCAR.png" alt="file"></p><p>背景：  2016年底 iOS App 强制要求使用HTTPS协议。Chrome 计划在2017年将所有使用非 HTTPS 协议的网站标记为不安全，并在地址栏的前面显示一个红叉。Mozilla 宣布所有的新特性将只提供给 HTTPS 网站，HTTP 网站将逐步被禁止访问浏览器功能。</p><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><h3 id="HTTP-的缺点"><a href="#HTTP-的缺点" class="headerlink" title="HTTP 的缺点"></a>HTTP 的缺点</h3><h4 id="使用明文通信"><a href="#使用明文通信" class="headerlink" title="使用明文通信"></a>使用明文通信</h4><p>http 没有加密功能， 无法对请求和响应的内容加密。内容在经过网络中间节点是容易被窃听。<br><img src="https://cdn.learnku.com/uploads/images/201702/06/4949/4y5A5AGezM.png" alt="file"></p><h4 id="不验证通信方身份"><a href="#不验证通信方身份" class="headerlink" title="不验证通信方身份"></a>不验证通信方身份</h4><p>HTTP  在请求和响应时， 不确认通信双方的身份。也就是说， 客户端无法确认返回的消息就是从真正的服务器上返回的， 有可能是从伪装的服务器上返回的。</p><p>同时， 服务端也不知道接收响应的客户端是否就是正真的目标客户端。<br>这就是中间人攻击。</p><p><img src="https://cdn.learnku.com/uploads/images/201702/06/4949/8CntTKYspj.png" alt="file"></p><h4 id="不验证报文完整性"><a href="#不验证报文完整性" class="headerlink" title="不验证报文完整性"></a>不验证报文完整性</h4><p>客户端端和服务端都无法确认收到的消息是否就是对方发送的原始消息， 有可能中间被修改。<br><img src="https://cdn.learnku.com/uploads/images/201702/06/4949/9DUNSe7JeX.png" alt="file"></p><h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>在不安全的网络上创建一安全信道。</p><h3 id="什么是HTTPS"><a href="#什么是HTTPS" class="headerlink" title="什么是HTTPS"></a>什么是HTTPS</h3><blockquote><p>TLS是传输层安全协议（Transport Layer Security）的缩写，是一种对基于网络的传输的加密协议，可以在受信任的第三方公证基础上做双方的身份认证。</p></blockquote><blockquote><p>SSL是TLS的前身，现在已不再更新  &gt;  <a href="https://segmentfault.com/a/1190000002554673">TSL&#x2F;SSL 原理</a></p></blockquote><blockquote><p>HTTPS是在基于TLS&#x2F;SSL的安全套接字上的的应用层协议，除了传输层进行了加密外，其它与常规HTTP协议基本保持一致</p></blockquote><p>简单来说就是 HTTPS &#x3D; HTTP + TLS&#x2F;SSL</p><p><img src="https://cdn.learnku.com/uploads/images/201702/06/4949/mKHv5Gv2rd.png" alt="file"></p><h3 id="如何弥补HTTP缺点的"><a href="#如何弥补HTTP缺点的" class="headerlink" title="如何弥补HTTP缺点的"></a>如何弥补HTTP缺点的</h3><h4 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h4><h5 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h5><ol><li><p>共享秘钥加密（对称密钥加密）</p><blockquote><p>使用双方共同拥有的单个密钥。这种密钥既用于加密，也用于解密，叫做机密密钥。</p></blockquote></li><li><p>公开秘钥加密（非对称加密）</p><blockquote><p>一个公钥和一个私钥，这两个密钥在数学上是相关的。在公钥加密中，公钥可在通信双方之间公开传递，或在公用储备库中发布，但相关的私钥是保密的。只有使用私钥才能解密用公钥加密的数据。使用私钥加密的数据只能用公钥解密。<img src="https://cdn.learnku.com/uploads/images/201702/06/4949/188EVQy31L.png" alt="file"></p></blockquote></li></ol><p>在HTTP应用中单纯的使用上面的任一中加密方式都存在问题：</p><ul><li>服务端如何安全的将秘钥发送给客户端？如果通信被窃听， 那么攻击者就在获得密文的同时获得秘钥，加密也就失去了意义。</li><li>如何让所有的客户端持有公钥？ 客户端如何确认收到的公开秘钥不是从中间人发送过来的假秘钥而是货真价实的真秘钥？</li></ul><h5 id="HTTPS-的加密方式"><a href="#HTTPS-的加密方式" class="headerlink" title="HTTPS 的加密方式"></a>HTTPS 的加密方式</h5><p>HTTPS 使用混合使用2中加密方式， 同时使用证书来证明公钥的正确性。</p><h4 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h4><p>目的： 为保证双方传递信息的 真实性、可靠性、完整性。</p><p>CA:  证书认证中心 (Certificate Authority) 中心。是一个负责发放和管理数字证书的第三方权威机构。</p><p>认证流程:</p><ol><li><p>把证书请求 (ssl.csr) 发给证书机构。</p></li><li><p>CA 确认申请人身份后使用 CA 机构的私钥对服务器公钥进行数字签名， 同时把已签名的公钥分配给机构， 并且把证书和公钥及签名进行绑定。</p><blockquote><p>也就是证书里面包含了服务器公钥 + CA 对公钥的数字签名。</p></blockquote></li><li><p>服务器把证书发送给客户端（浏览器）</p></li><li><p>客户端使用CA机构的公钥验证证书上的数字签名。 如果验证通过，则表明：</p><ul><li>CA 的认证服务器是有效的</li><li>CA 的公钥是有效的</li><li>服务器的公钥是有效的</li></ul><blockquote><p>合法的CA机构的公钥是内置在浏览器中的。</p></blockquote></li><li><p>客户端使用服务器的公钥对报文加密</p></li><li><p>服务器使用私钥解密报文</p></li></ol><h3 id="既然我们有开源的-openssl，-为什么还要去购买ssl证书"><a href="#既然我们有开源的-openssl，-为什么还要去购买ssl证书" class="headerlink" title="既然我们有开源的 openssl， 为什么还要去购买ssl证书?"></a>既然我们有开源的 openssl， 为什么还要去购买ssl证书?</h3><h4 id="https-安全的前提"><a href="#https-安全的前提" class="headerlink" title="https 安全的前提"></a>https 安全的前提</h4><p>数字证书颁发机构（CA）被客户端和服务端绝对信任。</p><h4 id="自签名证书"><a href="#自签名证书" class="headerlink" title="自签名证书"></a>自签名证书</h4><blockquote><p><a href="https://segmentfault.com/a/1190000002569859">基于OpenSSL自建CA和颁发SSL证书</a></p></blockquote><p>就是自己扮演 CA 机构，自己给自己的服务器颁发证书。</p><p>由于自签名证书无法排除被中间人伪造的可能， 所有浏览器对自签名证书不信任，浏览的时候回给出风险提示。</p><p><img src="https://cdn.learnku.com/uploads/images/201702/06/4949/gVSU1kcUtQ.png" alt="file"></p><p><strong>因此， 只有值得信赖的第三方机构介入， 才能让植入在浏览器中的认证机构公开秘钥发挥作用， 从而借此证明服务器的真实性。</strong></p><h4 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h4><p>Mozilla 和 Google 宣布对 WoSign 和 StartCom ( StartSSL ) 一年内新签发的所有SSL证书不信任。</p><blockquote><p>360 &gt; WoSign &gt; StartCom</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;这是一篇内部分享文&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.learnku.com/uploads/images/201702/06/4949/nx3raoaCAR.png&quot; alt=&quot;file&quot;&gt;&lt;/</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="HTTPS" scheme="https://www.wewx.cn/tags/HTTPS/"/>
    
    <category term="网络" scheme="https://www.wewx.cn/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>GitHub 多账号的 SSH 配置</title>
    <link href="https://www.wewx.cn/2017/01/01/github-multi-account-ssh-configuration/"/>
    <id>https://www.wewx.cn/2017/01/01/github-multi-account-ssh-configuration/</id>
    <published>2017-01-01T00:00:00.000Z</published>
    <updated>2022-04-21T05:07:21.011Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>有这样的情况，现在有 2 个 github 账号。现在都想使用 ssh key 的方式拉取代码。但是第二个账号无法使用，怎么办?</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="1-生成-SSH-key"><a href="#1-生成-SSH-key" class="headerlink" title="1. 生成 SSH key"></a>1. 生成 SSH key</h3><p>1.1 生成第一个 key</p><pre><code>$ ssh-keygen -t rsa -C &quot;user1@email.com&quot;</code></pre><p>然后，回车确认即可。最后会生成</p><pre><code>id_rsaid_rsa.pub</code></pre><p>2个文件。</p><p>1.2 生成第二个 key</p><pre><code>$ ssh-keygen -t rsa -C &quot;user2@email.com&quot;</code></pre><p>注意，这里需要给 key 设置名称。要不然会覆盖第一个key，例如:</p><pre><code> ~/.ssh/id_rsa_user2@email.com</code></pre><p>至此，我们会得到4个文件。</p><h3 id="2-添加密钥到-SSH-agent-中"><a href="#2-添加密钥到-SSH-agent-中" class="headerlink" title="2. 添加密钥到 SSH agent 中"></a>2. 添加密钥到 SSH agent 中</h3><pre><code>$ ssh-agent bash$ ssh-add ~/.ssh/id_rsa_user2@email.com</code></pre><h3 id="3-修改-SSH-的-config-配置"><a href="#3-修改-SSH-的-config-配置" class="headerlink" title="3. 修改 SSH 的 config 配置"></a>3. 修改 SSH 的 config 配置</h3><pre><code>$ touch config    </code></pre><p>增加:</p><pre><code>HOST user2.githubhostname github.comIdentityFile ~/.ssh/id_rsa_user2@email.comUser user2@email.com</code></pre><h3 id="4-配置公钥"><a href="#4-配置公钥" class="headerlink" title="4. 配置公钥"></a>4. 配置公钥</h3><p>把 id_rsa.pub  和 <a href="mailto:&#x69;&#x64;&#x5f;&#x72;&#115;&#97;&#95;&#x75;&#x73;&#101;&#114;&#50;&#x40;&#x65;&#x6d;&#x61;&#105;&#x6c;&#46;&#x63;&#x6f;&#109;&#46;&#112;&#x75;&#98;">&#x69;&#x64;&#x5f;&#x72;&#115;&#97;&#95;&#x75;&#x73;&#101;&#114;&#50;&#x40;&#x65;&#x6d;&#x61;&#105;&#x6c;&#46;&#x63;&#x6f;&#109;&#46;&#112;&#x75;&#98;</a> 文件的内容添加到对应账号的公钥配置中。</p><h3 id="5-拉取项目"><a href="#5-拉取项目" class="headerlink" title="5. 拉取项目"></a>5. 拉取项目</h3><p>例如，user2 要克隆这个项目:</p><pre><code>git@github.com:EvaEngine/Dockerfiles.git</code></pre><p>则执行下面的命令即可:</p><pre><code>$ git clone git@user2.github:EvaEngine/Dockerfiles.git</code></pre><p>注意，地址中的 host 替换为了 config 中配置的名称。</p><p>搞定。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;有这样的情况，现在有 2 个 github 账号。现在都想使用 ssh key 的方式拉取代码。但是第二个账号无法使用，怎么办?&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="技术" scheme="https://www.wewx.cn/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="docker" scheme="https://www.wewx.cn/tags/docker/"/>
    
    <category term="容器" scheme="https://www.wewx.cn/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
</feed>
